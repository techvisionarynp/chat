  </div>
            
            <div id="response" class="hidden">
                <h2>TV AI Responded</h2>
                <p id="ai-response">TV AI is typing...</p>
            </div>
            <textarea id="user-input" rows="10" cols="80" placeholder="Ask me anything..."></textarea><br>
            <div class="btn-group">
                <button class="btn" onclick="sendPrompt()">Send Prompt</button>
                <button class="btn" onclick="clearChat()">New Chat</button>
                <button class="btn" onclick="openPrompt()">Open Prompt</button>
                <button class="btn" onclick="pastePrompt()">Paste Prompt</button>
                <button class="btn" onclick="searchGoogle()">Search Google</button>
            </div>

            <div class="btn-group">
                <button class="btn" onclick="copyResponse()">Copy Response</button>
                <button class="btn" onclick="saveResponse()">Save Response</button>
                <button class="btn" onclick="exportHistory()">Export History</button>
                <button class="btn" onclick="deleteHistory()">Delete History</button>
            </div>



            <div id="history-container" class="hidden">
                <h2>Chat History</h2>
                <ul id="history-list"></ul>
            </div>
        </div>
    </section>

    <script>
        // Initialize chat history from localStorage
        let chatHistory = JSON.parse(localStorage.getItem('chatHistory')) || [];

        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
        }

        function updateGreeting() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes().toString().padStart(2, '0');
            const seconds = now.getSeconds().toString().padStart(2, '0');
            const timeString = `${hours}:${minutes}:${seconds}`;
            const dateString = now.toDateString();
            
            let greeting;
            if (hours < 12) {
                greeting = "Good morning";
            } else if (hours < 18) {
                greeting = "Good afternoon";
            } else {
                greeting = "Good evening";
            }

            document.getElementById('greeting').innerText = `${greeting}, today is ${dateString} and it's ${timeString}.`;
        }

        setInterval(updateGreeting, 1000);

        function sendPrompt() {
            const userInput = document.getElementById('user-input').value;
            if (!userInput.trim()) return;

            // Show user input under "You Asked"
            document.getElementById('user-question').innerText = userInput;
            document.getElementById('you-asked').classList.remove('hidden');
            document.getElementById('response').classList.remove('hidden');
            
            document.getElementById('ai-response').innerText = 'TV AI is typing...';

            const apiGemini = "AIzaSyDYeLxp7Jp5qSypbVBPy9v_XYmz7Sc1qfs";
            const headers = { 'Content-Type': 'application/json' };
            const data = {
                "contents": [{
                    "parts": [{
                        "text": userInput
                    }]
                }]
            };

            fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiGemini}`, {
                method: 'POST',
                headers: headers,
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('ai-response').innerText = data.candidates[0].content.parts[0].text;
                saveToHistory(userInput, data.candidates[0].content.parts[0].text);
            })
            .catch(error => {
                document.getElementById('ai-response').innerText = "Error: " + error.message;
            });

            // Clear input after sending
            document.getElementById('user-input').value = '';
        }

        function saveToHistory(userInput, aiResponse) {
            const chat = { userInput, aiResponse, date: new Date().toLocaleString() };
            chatHistory.push(chat);
            localStorage.setItem('chatHistory', JSON.stringify(chatHistory));
            showHistory();
        }

        function showHistory() {
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = '';
            if (chatHistory.length === 0) {
                document.getElementById('history-container').classList.add('hidden');
            } else {
                document.getElementById('history-container').classList.remove('hidden');
                chatHistory.forEach((chat, index) => {
                    const listItem = document.createElement('li');
                    listItem.innerText = `${chat.date}: ${chat.userInput} -> ${chat.aiResponse}`;
                    historyList.appendChild(listItem);
                });
            }
        }

        function clearChat() {
            document.getElementById('user-input').value = '';
            document.getElementById('you-asked').classList.add('hidden');
            document.getElementById('response').classList.add('hidden');
        }

        function openPrompt() {
            const file = prompt("Enter file path to open prompt (simulate loading a text file):");
            if (file) {
                document.getElementById('user-input').value = file; // Simulate loading the file content
            }
        }

        function pastePrompt() {
            navigator.clipboard.readText().then(text => {
                document.getElementById('user-input').value = text;
            });
        }

        function copyResponse() {
            const response = document.getElementById('ai-response').innerText;
            navigator.clipboard.writeText(response).then(() => {
                alert('Response copied to clipboard!');
            });
        }

        function saveResponse() {
            const response = document.getElementById('ai-response').innerText;
            const format = prompt("Choose format to save response (txt, html, md):");

            if (format === 'txt') {
                saveFile(response, 'response.txt');
            } else if (format === 'html') {
                saveFile(`<html><body>${response}</body></html>`, 'response.html');
            } else if (format === 'md') {
                saveFile(`## AI Response\n\n${response}`, 'response.md');
            } else {
                alert("Invalid format selected.");
            }
        }

        function saveFile(content, filename) {
            const blob = new Blob([content], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = filename;
            link.click();
        }

        function exportHistory() {
            const historyData = JSON.stringify(chatHistory, null, 2);
            saveFile(historyData, 'chat_history.json');
        }

        function deleteHistory() {
            localStorage.removeItem('chatHistory');
            chatHistory = [];
            showHistory();
        }

        function searchGoogle() {
            const query = document.getElementById('user-input').value;
            if (query.trim()) {
                window.open(`https://www.google.com/search?q=${encodeURIComponent(query)}`, '_blank');
            }
        }

        showHistory();
    </script>

</body>
</html>
